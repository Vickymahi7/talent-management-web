import{d as ae,u as oe,P as fe,Q as q,l as A,H as K,D as ke,o as a,j as n,h as t,w as U,F as d,k as w,t as m,G as L,z as g,m as le,R as ge,S as be,T as we,p as Le,r,c as ee,V as Me,q as Te,W as Ue,E as Ce,J as Ie,v as Pe,L as $e,i as I,x as b,n as Se,K as xe,s as Ee,f as F,U as te,X as D,Y as Ae,Z as Re,$ as He,I as Ne,a0 as se,A as Be}from"./index-c0797ffd.js";import{r as Ve}from"./bootstrap-vue-next-57b53e13.js";import{a as Oe,_ as Fe}from"./HrProfile.vue_vue_type_script_setup_true_lang-7cac4999.js";import{f as De}from"./dateFormats-ed53e278.js";import"./ResumePreviewModal-6d3d5c25.js";const qe=ae({props:{id:{type:String,default:"inviteAdUsersModal"},accessToken:{type:String}},data(){return{toast:oe(),isModalLoading:!1,isPageEnd:!1,nextPageToken:"",users:[],inviteUserList:[]}},beforeMount(){this.getAdUserList()},mounted(){this.getNextUser()},methods:{async getAdUserList(){if(this.accessToken&&!this.isPageEnd){this.isModalLoading=!0;try{const s=await fe(this.accessToken,this.nextPageToken);s.value&&(this.nextPageToken=s["@odata.nextLink"],this.isPageEnd=!s["@odata.nextLink"],this.users=this.users.concat(s.value))}catch{}finally{this.isModalLoading=!1}}},getNextUser(){window.onscroll=()=>{document.documentElement.scrollTop+window.innerHeight===document.documentElement.offsetHeight&&this.getAdUserList()}},showModal(s){const i=document.getElementById(s);if(!i)return;q.getOrCreateInstance(i,{keyboard:!1}).show()},manageInviteList(s){this.inviteUserList.some(i=>i.mail==s.mail)?this.inviteUserList=this.inviteUserList.filter(({mail:i})=>i!=s.mail):this.inviteUserList.push({displayName:s.displayName,mail:s.mail})},handleScroll(s,i,p){const v=this.$refs[s];v.scrollTop+v.clientHeight>=v.scrollHeight-20&&i&&this[p]()},async inviteAdUsers(){if(this.inviteUserList.length>10){this.toast.error("Please select a maximum of 10 users");return}try{const s={users:this.inviteUserList};this.isModalLoading=!0;const i=await A.post("/user/aduserinvite",s);i.status==K.Ok&&this.toast.success(i.message)}catch(s){this.toast.error(s.message)}finally{this.isModalLoading=!1}}}}),Ke=["id"],ze={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},Ge={class:"modal-content"},We=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"modalLabel"},"Invite Active Directory Users"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Ye={class:"list-group"},je=["value","onChange"],Je={class:"row d-inline-block"},Qe={class:"col card-title"},Xe={class:"col"},Ze={key:0,class:"text-center"},et={class:"modal-footer"},tt={key:0,class:"badge bg-light text-dark"},st=t("button",{type:"button",class:"btn secondary-btn","data-bs-dismiss":"modal"},"Close",-1);function at(s,i,p,v,z,R){const _=le;return a(),n("div",{class:"modal fade",id:s.id,tabindex:"-1","aria-labelledby":"modalLabel","aria-hidden":"true"},[t("div",ze,[U((a(),n("div",Ge,[We,t("div",{class:"modal-body",onScroll:i[0]||(i[0]=y=>s.handleScroll("scroller",!s.isModalLoading,"getAdUserList")),ref:"scroller"},[t("div",Ye,[(a(!0),n(d,null,w(s.users,y=>(a(),n("label",{key:y.id,class:"list-group-item d-flex align-items-center"},[t("input",{class:"form-check-input checkbox-lg me-3 mt-0",type:"checkbox",value:s.inviteUserList.some(C=>C.mail==y.mail),onChange:C=>s.manageInviteList(y)},null,40,je),t("div",Je,[t("div",Qe,m(y.displayName),1),t("div",Xe,m(y.mail),1)])]))),128)),s.users.length==0?(a(),n("div",Ze," No Users found ")):L("",!0)])],544),t("div",et,[t("button",{type:"button",class:"btn btn-primary",onClick:i[1]||(i[1]=(...y)=>s.inviteAdUsers&&s.inviteAdUsers(...y))},[g(" Invite "),s.inviteUserList.length>0?(a(),n("span",tt,m(s.inviteUserList.length),1)):L("",!0)]),st])])),[[_,s.isModalLoading]])])],8,Ke)}const ot=ke(qe,[["render",at]]);function lt(){const s=ge();if(!s)throw"useMsal() cannot be called outside the setup() function of a component";const{instance:i,accounts:p,inProgress:v}=be(s.appContext.config.globalProperties.$msal);if(!i.value||!p.value||!v.value)throw"Please install the msalPlugin";return v.value===we.Startup&&i.value.initialize().then(()=>{i.value.handleRedirectPromise().catch(()=>{})}),{instance:i.value,accounts:p,inProgress:v}}const nt=t("div",{class:"content-card content-header card-gap-mb"},[t("label",null,"Profile Management")],-1),it={class:"content-body content-card"},ct={class:"row filter-group py-2 align-items-center"},rt={class:"col-3"},dt=["onKeyup"],ut={class:"col"},mt=["id","value"],pt=["for"],ht={class:"col text-end"},_t={class:"table-responsive"},vt={class:"table table-borderless custom-table-style"},yt={class:"table-primary"},ft={class:"custom-tbody-style"},kt=["onClick"],gt=["onClick"],bt={key:0,class:"form-check-input",type:"checkbox"},wt=["title"],Lt={key:0},Mt=["onUpdate:modelValue","onChange","onBlur","aria-label"],Tt=t("option",{value:null},"Select",-1),Ut=["value"],Ct={key:1},It={class:"icon-btn me-2"},Pt={class:"icon-btn me-2"},$t=["onClick"],St={key:0},xt=t("td",{colspan:"12",class:"text-center"}," No record found ",-1),Et=[xt],At={class:"modal fade",id:"hrProfileModal",tabindex:"-1","aria-labelledby":"modalLabel","aria-hidden":"true"},Rt={class:"modal-dialog modal-fullscreen"},Ht={class:"modal-content"},Nt={class:"modal-body profile-modal"},Bt=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn secondary-btn","data-bs-dismiss":"modal"},"Close")],-1),Kt=ae({__name:"HrProfileManagement",setup(s){const i=lt().instance,p=oe(),v=Be(),z=Le(),R=r(null),_=r(!1),y=r(!1),C=r(!1),H=r(""),N=r([]),P=r(null),$=r(null),S=r(null),G=r(null),B=r(""),x=r([]),W=[{key:"select",label:""},{key:"index",label:"SN"},{key:"profile_title",label:"Profile Title"},{key:"first_name",label:"Resource Name"},{key:"email_id",label:"Email ID"},{key:"skills",label:"Skills"},{key:"status_id",label:"Profile Status",isEditable:!0},{key:"last_updated_dt",label:"Last Updated"},{key:"actions",label:"Action"}],Y=r(1),M=r(1),E=r(10),V=r({id:null}),ne=ee(()=>(M.value-1)*E.value),j=ee(()=>{const e=localStorage.getItem("userTypeId");return e?parseInt(e):null});Me(M,()=>{k()}),Te(()=>{k()}),Ue(()=>{ve("hrProfileModal")});const k=async()=>{try{const e={searchText:H.value,status_id:N.value,rows:E.value,start:ne.value};_.value=!0;const o=await A.get("/hrprofile/list",{params:e});x.value=o.hrProfileList,Y.value=o.numFound,M.value=o.numFound>E.value?M.value:1}catch(e){p.error(e.message)}finally{_.value=!1}},ie=async(e,o,u)=>{const f={};f.id=e.id,f.hr_profile_id=e.hr_profile_id,f.user_id=e.user_id,f.email_id=e.email_id,f[o]=u;try{_.value=!0;const T=await A.patch("/hrprofile/update",f);T.status==K.Ok&&(p.success(T.message),k(),P.value=null,$.value=null,S.value=null)}catch(T){p.error(T.message)}finally{_.value=!1}},ce=e=>{V.value.id=e},re=async()=>{try{_.value=!0;const e=await A.delete("/hrprofile/delete/"+V.value.id);e.status==K.Ok&&(p.success(e.message),k())}catch(e){p.error(e.message)}finally{_.value=!1}},de=e=>{let o="";return e&&e.length>0&&e.forEach((u,f)=>{f!=0&&(o+=", "),o+=u.skill}),o},ue=(e,o)=>{j.value==te.USR?z.push({name:"hrprofile",params:{id:o}}):(B.value=o,Q(e))},me=(e,o,u)=>{e.isEditable&&(u.stopPropagation(),P.value=o.id,$.value=e.key,S.value=o[e.key])},pe=(e,o)=>{e[o.key]=S,P.value=null,$.value=null,S.value=null,k()},J=async()=>{await i.loginPopup(D),he()},he=async()=>{_.value=!0;const e=await i.acquireTokenSilent({...D}).catch(async o=>{if(o instanceof Ae||o instanceof Re)await i.loginPopup(D),J();else throw o}).finally(()=>{_.value=!1});e!=null&&e.accessToken&&(G.value=e.accessToken,C.value=!0,He(()=>{Q("inviteAdUsersModal")}))},_e=()=>{var e;(e=R.value)==null||e.showModal()},Q=e=>{const o=document.getElementById(e);if(!o)return;q.getOrCreateInstance(o,{keyboard:!1}).show()},ve=e=>{const o=document.getElementById(e);if(!o)return;q.getOrCreateInstance(o,{keyboard:!1}).hide()};return(e,o)=>{const u=Ce("font-awesome-icon"),f=Ve,T=Ne,ye=ot,X=le;return a(),n(d,null,[nt,U((a(),n("div",it,[t("div",ct,[t("div",rt,[U(t("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=l=>H.value=l),class:"form-control",onKeyup:Ie(k,["enter"]),placeholder:"Search Profile Title, Email, Skill, Summary","aria-label":"Search"},null,40,dt),[[Pe,H.value]])]),t("div",ut,[(a(!0),n(d,null,w(I(se),l=>(a(),n("div",{key:l.id,class:"form-check form-check-inline mb-0"},[U(t("input",{class:"form-check-input","onUpdate:modelValue":o[1]||(o[1]=O=>N.value=O),type:"checkbox",id:"inlineRadio"+l.id,value:l.id,onChange:k},null,40,mt),[[$e,N.value]]),t("label",{class:"form-check-label",for:"inlineRadio"+l.id},m(l.status),9,pt)]))),128))]),t("div",ht,[t("button",{class:"btn btn-primary",type:"button",onClick:_e},[b(u,{class:"me-2",icon:"fa-solid fa-plus-circle"}),g(" New Profile ")]),j.value!=I(te).USR?(a(),n("button",{key:0,class:"btn btn-primary ms-2",type:"button",onClick:J},[b(u,{class:"me-2",icon:"fa-solid fa-upload"}),g(" Profile Excel Import ")])):L("",!0)])]),t("div",_t,[t("table",vt,[t("thead",yt,[t("tr",null,[(a(),n(d,null,w(W,l=>t("th",{scope:"col",key:l.key},m(l.label),1)),64))])]),t("tbody",ft,[(a(!0),n(d,null,w(x.value,(l,O)=>(a(),n("tr",{key:l.id,onClick:c=>ue("hrProfileModal",l.id)},[(a(),n(d,null,w(W,c=>t("td",{key:c.key,onClick:h=>me(c,l,h),class:Se({"clickable-cell":c.isEditable})},[c.key=="select"?(a(),n("input",bt)):c.key=="index"?(a(),n(d,{key:1},[g(m(O+1),1)],64)):c.key=="first_name"?(a(),n(d,{key:2},[g(m(l.first_name)+" "+m(l.last_name),1)],64)):c.key=="skills"?(a(),n("div",{key:3,class:"text-truncate table-th-width",title:de(l.skills)},[(a(!0),n(d,null,w(l.skills,(h,Z)=>(a(),n("span",{key:Z},[g(m(h.skill),1),l.skills&&Z<l.skills.length-1?(a(),n("span",Lt,", ")):L("",!0)]))),128))],8,wt)):c.key=="status_id"?(a(),n(d,{key:4},[P.value==l.id&&$.value==c.key?U((a(),n("select",{key:0,class:"form-select form-control-sm","onUpdate:modelValue":h=>l[c.key]=h,onChange:h=>ie(l,c.key,l[c.key]),onBlur:h=>pe(l,c.key),"aria-label":c.label},[Tt,(a(!0),n(d,null,w(I(se),h=>(a(),n("option",{key:h.id,value:h.id},m(h.status),9,Ut))),128))],40,Mt)),[[xe,l[c.key]]]):(a(),n("span",Ct,m(I(v).getProfileStatusById(l.status_id)),1))],64)):c.key=="last_updated_dt"?(a(),n(d,{key:5},[g(m(I(De)(l.last_updated_dt)),1)],64)):c.key=="actions"?(a(),n(d,{key:6},[t("div",It,[b(u,{icon:"fa-solid fa-paperclip"})]),t("div",Pt,[b(u,{icon:"fa-solid fa-download"})]),t("div",{class:"icon-btn me-2",onClick:Ee(h=>ce(l.id),["stop"]),title:"Delete Profile","data-bs-toggle":"modal","data-bs-target":"#deleteHrProfile"},[b(u,{icon:"fa-solid fa-trash"})],8,$t)],64)):(a(),n(d,{key:7},[g(m(l[c.key]),1)],64))],10,gt)),64))],8,kt))),128)),x.value.length==0?(a(),n("tr",St,Et)):L("",!0)])])]),x.value.length>0?(a(),F(f,{key:0,modelValue:M.value,"onUpdate:modelValue":o[2]||(o[2]=l=>M.value=l),pills:"","total-rows":Y.value,"per-page":E.value,size:"sm"},null,8,["modelValue","total-rows","per-page"])):L("",!0)])),[[X,_.value]]),b(Oe,{id:"addHrProfileModal-profileManage",ref_key:"addHrProfileModalRef",ref:R,onRefreshParent:k},null,512),b(T,{id:"deleteHrProfile",onYes:re,returnParams:V.value,title:"Delete Confirmation",message:"Are you sure to delete profile?"},null,8,["returnParams"]),C.value?(a(),F(ye,{key:0,accessToken:G.value},null,8,["accessToken"])):L("",!0),t("div",At,[t("div",Rt,[U((a(),n("div",Ht,[t("div",Nt,[(a(),F(Fe,{id:B.value,key:B.value},null,8,["id"]))]),Bt])),[[X,y.value]])])])],64)}}});export{Kt as default};
